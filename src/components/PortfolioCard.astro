---
import type { PortfolioBucket } from "../lib/types";

interface Props {
  bucket: PortfolioBucket;
  index: number;
  color: string;
}

const { bucket, index, color } = Astro.props;
const number = String(index + 1).padStart(2, "0");
const allocMax = parseFloat(bucket.targetRange?.split("-")[1] || "20");
const allocPercent = Math.min((allocMax / 35) * 100, 100);
const direction = index % 2 === 0 ? "reveal-left" : "reveal-right";
---

<article
  class:list={["portfolio-card", direction]}
  style={`--d: ${index + 1}`}
  data-tilt
>
  <div class="flex items-start justify-between gap-3">
    <span class="card-number">{number}</span>
    <span
      class="inline-block h-3 w-3 rounded-full"
      style={`background: ${color}; box-shadow: 0 0 8px ${color}44;`}
    />
  </div>

  <p class="label-bracket mt-4 text-xs text-accent">{bucket.label}</p>

  <p class="mt-3 text-2xl font-semibold tracking-[-0.02em] text-ink md:text-3xl">
    {bucket.targetRange ?? "Flexible range"}
  </p>

  <div class="mt-4">
    <div class="alloc-bar-track">
      <div
        class="alloc-bar-fill"
        style={`width: ${allocPercent}%; background: linear-gradient(90deg, ${color} 0%, ${color}99 100%); --d: ${index};`}
      />
    </div>
  </div>

  <p class="mt-4 text-sm leading-relaxed text-ink-soft">{bucket.thesis}</p>

  {bucket.riskNotes && (
    <div class="mt-4 rounded-lg border border-line/60 bg-white/50 px-3 py-2.5">
      <p class="text-xs font-semibold uppercase tracking-[0.06em] text-ink-soft">Risk note</p>
      <p class="mt-1 text-xs leading-relaxed text-ink-soft">{bucket.riskNotes}</p>
    </div>
  )}
</article>
