---
import { Image } from "astro:assets";
import type { SubstackPost } from "../lib/types";

interface Props {
  post: SubstackPost;
}

const { post } = Astro.props;
const published = new Date(post.publishedAt);
const publishedLabel = Number.isNaN(published.getTime())
  ? "Unknown date"
  : published.toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
    });
const localImage = post.coverImage?.startsWith("/") ? post.coverImage : undefined;
---

<article class="section-card reveal overflow-hidden p-0">
  <a
    href={post.url}
    target="_blank"
    rel="noreferrer"
    aria-label={`Open ${post.title} on Substack`}
    data-track-event="click_substack"
    class="group block h-full p-5 md:p-6"
  >
    {
      post.coverImage && (
        <div class="overflow-hidden rounded-lg">
        {localImage ? (
          <Image
            src={localImage}
            alt={`Preview illustration for ${post.title}`}
            width={1200}
            height={675}
            loading="lazy"
            class="mb-4 h-48 w-full border border-line/60 object-cover transition-transform duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] group-hover:scale-[1.04] md:h-56"
          />
        ) : (
          <img
            src={post.coverImage}
            alt={`Preview illustration for ${post.title}`}
            loading="lazy"
            decoding="async"
            width="1200"
            height="675"
            class="mb-4 h-48 w-full border border-line/60 object-cover transition-transform duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] group-hover:scale-[1.04] md:h-56"
          />
        )}
      </div>
      )
    }
    <p class="label-bracket text-xs font-semibold text-accent">{publishedLabel}</p>
    <h3 class="mt-2 text-2xl font-semibold leading-tight text-ink transition-colors duration-300 group-hover:text-accent md:text-[1.75rem]">
      {post.title}
    </h3>
    <p class="mt-4 text-base leading-relaxed text-ink-soft">{post.excerpt || "Read the full article on Substack."}</p>
  </a>
</article>
